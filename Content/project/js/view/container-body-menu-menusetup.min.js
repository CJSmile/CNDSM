function swalConfirmSaveMenuDragging(n,t,i){swal({title:"Are you sure, you want to save?",type:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,closeOnCancel:!1,confirmButtonClass:"btn theme default-button",cancelButtonClass:"btn btn-danger",preConfirm:function(){var r=new ObjUrl(n),u=r.getUrlFromJson(),f={model:t,modelDrag:i};return new Promise(function(){$.ajax({url:u,async:ajax_async,cache:ajax_cache,type:ajax_type_post,data:f,timeout:ajax_timeout}).done(function(n){vmViewIndex.menu.foodSetJs(ko.mapping.toJS(vmViewIndex.menu.foodSet));vmViewIndex.menu.foodCategoryJs(ko.mapping.toJS(vmViewIndex.menu.foodCategory));vmViewIndex.menu.foodJs(ko.mapping.toJS(vmViewIndex.menu.food));vmViewIndex.menu.tempDataDragging([]);vmViewIndex.menu.tempItemDragging([]);vmViewIndex.menu.chkDrag(!1);MapDataMenu(vmViewIndex.menu.foodSetJs(),vmViewIndex.menu.foodCategoryJs(),vmViewIndex.menu.foodJs(),vmViewIndex.menu.foodSetTimeMapJs(),vmViewIndex.menu.valueFilterMenuFoodSet(),vmViewIndex.menu.valueFilterMenuFoodCat(),vmViewIndex.menu.valueFilterMenuFood(),products.cAllProduct);$(".foodSetDrag").sortable("enable");$(".foodCatDrag").sortable("enable");$(".foodDrag").sortable("enable");var t=new ObjAlert("",n.message,n.status);t.getAlert()}).fail(function(n){var t=new ObjAlert("",n.message,n.status);t.getAlert()})})}}).then(function(){},function(n){n==="cancel"&&(vmViewIndex.showLoading(!0),undoMenuDragging(),swal("Cancelled","",cSwal_Icon_Error))})}function undoMenuDragging(){vmViewIndex.menu.chkDrag(!1);MapDataMenu(vmViewIndex.menu.foodSetJs(),vmViewIndex.menu.foodCategoryJs(),vmViewIndex.menu.foodJs(),vmViewIndex.menu.foodSetTimeMapJs(),vmViewIndex.menu.valueFilterMenuFoodSet(),vmViewIndex.menu.valueFilterMenuFoodCat(),vmViewIndex.menu.valueFilterMenuFood(),products.cAllProduct);vmViewIndex.menu.dataMenu.valueHasMutated();vmViewIndex.menu.tempDataDragging([]);vmViewIndex.menu.tempItemDragging([]);$(".foodSetDrag").sortable("enable");$(".foodCatDrag").sortable("enable");$(".foodDrag").sortable("enable");vmViewIndex.showLoading(!1)}function initMenuDragging(n,t,i,r,u,f,e,o,s){var v,p,l,h,c=0,a=0,w=!1,y,b;$(n).sortable({handle:i,cursor:"move",forcePlaceholderSize:!1,opacity:.4,placeholder:"placeholder",cursorAt:{top:0,left:0},start:function(n,t){y=t.item.index();b=_.first(t.item).id},update:function(n,t){w=!0;b=_.first(t.item).id},stop:function(n,i){var wt=_.first(i.item).id,d,g,ft,ot,vt,st,ht,rt,ct,yt,k,et,nt,tt,b,pt,it;if(w!=!1){d=i.item.index();g=$("."+t+"> div");r=="foodSet"&&(g=$("."+t+"> label"),y=Math.ceil(y/2)-1,d=Math.ceil(d/2)-1);var lt=d>y,at=d+(lt?-1:1),ut=d<y?1:-1;if(y!=d){if(ft=g.get(at),ft){c=y;a=d;switch(r){case"foodSet":ot=$(g.get(y));lt?$(ft).insertBefore(ot):$(ft).insertAfter(ot);$(".foodCatDrag").sortable("disable");$(".foodDrag").sortable("disable");v=g.get(d).id;filterDragging=ko.utils.arrayFilter(e(),function(n){return n.foodSet.foodSetId()==v});p=g.get(at).id;vt=ko.utils.arrayFilter(e(),function(n){return n.foodSet.foodSetId()==p});l=_.first(filterDragging).foodSet.foodSetSorting();h=_.first(vt).foodSet.foodSetSorting();l==h&&(c>a?h==1?l+=1:h-=1:h+=1);st=!1;ht=!1;ko.utils.arrayForEach(e(),function(n){n.foodSet.foodSetId()==v?(n.foodSet.foodSetSorting(h),st||(st=!0,o.push(n.foodSet),s.push(n.foodSet))):n.foodSet.foodSetId()==p&&(n.foodSet.foodSetSorting(l),ht||(ht=!0,o.push(n.foodSet)))});break;case"foodCategory":if($(".foodSetDrag").sortable("disable"),$(".foodDrag").sortable("disable"),v=e()[c][r][u](),p=e()[a][r][u](),l=e()[c][r][f],h=e()[a][r][f],l()==h()&&(rt=h(),ct=l(),c>a?rt==1?(ct+=1,l(ct)):rt-=1:rt+=1,h(rt)),et=ko.observable(),nt=ko.observableArray([]),ko.mapping.fromJS(h(),{},et),ko.mapping.fromJS(e(),{},nt),tt=ko.mapping.toJS(nt),Math.max(c,a)-Math.min(c,a)>1)for(b=Math.min(c,a);b<Math.max(c,a);b++)e()[b][r][f]()<Math.max(l(),h())&&e()[b][r][f]()>Math.min(h(),l())&&(e()[b][r][f](tt[b+ut][r][f]),o.push(e()[b][r]));for(b=0;b<e().length;b++)e()[b][r][u]()==v&&(e()[b][r][f](h()),o.push(e()[b][r]),s.push(e()[b][r]));for(b=0;b<e().length;b++)e()[b][r][u]()==p&&(e()[b][r][f](tt[b+ut][r][f]),o.push(e()[b][r]));it=e()[c];$("div[data-id='foodCat"+c+"']").remove();e.remove(function(n){return n.foodCategory.foodCatId()==v});e.splice(a,0,it);yt="#head"+it.foodSet.foodSetSorting()+"_"+it.foodCategory.foodCatSorting();$(yt).find("a.link-zoom").click();break;case"food":for($(".foodSetDrag").sortable("disable"),$(".foodCatDrag").sortable("disable"),k=_.first(i.item).offsetParent.id,v=e()[k][r][c][u](),p=e()[k][r][a][u](),l=e()[k][r][c][f],h=e()[k][r][a][f],et=ko.observable(),nt=ko.observableArray([]),ko.mapping.fromJS(h(),{},et),ko.mapping.fromJS(e(),{},nt),tt=ko.mapping.toJS(nt),b=0;b<e()[k][r].length;b++)e()[k][r][b][f]()<Math.max(l(),h())&&e()[k][r][b][f]()>Math.min(h(),l())&&(e()[k][r][b][f](tt[k][r][b+ut][f]),o.push(e()[k][r][b]));for(b=0;b<e()[k][r].length;b++)e()[k][r][b][u]()==v&&(e()[k][r][b][f](h()),o.push(e()[k][r][b]),s.push(e()[k][r][b]));for(b=0;b<e()[k][r].length;b++)e()[k][r][b][u]()==p&&(e()[k][r][b][f](tt[k][r][b+ut][f]),o.push(e()[k][r][b]));pt=e()[k].foodCategory.foodCatId();it=e()[k][r][c];e()[k][r].splice(c,1);e()[k][r].splice(a,0,it)}}vmViewIndex.menu.foodTypeDragging=r;vmViewIndex.menu.chkDrag(!0)}}n.stopImmediatePropagation();vmViewIndex.menu.dataMenu.valueHasMutated()}})}function CopyfoodInFoodCategory(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d){var g=this;g.FoodId=ko.observable(n);g.TempId=ko.observable(t);g.FoodName=ko.observable(i);g.FoodNameAlt=ko.observable(r);g.FoodDesc=ko.observable(u);g.FoodPrice=ko.observable(e);g.Image=ko.observable(o);g.Active=ko.observable(s);g.RevenueClassId=ko.observable(h);g.TaxRateId=ko.observable(c);g.FoodCatId=ko.observable(l);g.FoodSetId=ko.observable(a);g.AllChoiceOptions=ko.observable(v);g.ProductId=ko.observable(f());g.IsOutStock=ko.observable(y);g.IsFree=ko.observable(p);g.IsShow=ko.observable(w);g.ProductTagMap=ko.observable(ko.toJSON(b));g.Plu=ko.observable(k);g.ImageThirdParty=ko.observable(d)}function getChoiceOptions(n){var t=this;t.ChoiceOptionId=ko.observable("");t.ChoiceOptionName=ko.observable("");t.Active=ko.observable(!0);t.CheckData=ko.observable(n);t.Choice=ko.observableArray([]);t.Plu=ko.observable("")}function getChoice(n,t,i,r,u,f,e){var o=this;o.ChoiceId=ko.observable(n);o.ChoiceName=ko.observable(t);o.ChoicePrice=ko.observable(i).extend({numeric:2});o.ChoiceOptionId=ko.observable(r);o.IsDefault=ko.observable(u);o.checkedIsDefault=ko.observable(f);o.Plu=ko.observable(e)}function optionSelectFoodSet(n,t){var i=this;i.foodSetId=ko.observable(n);i.foodSetName=ko.observable(t)}function optionSelectFoodCategory(n,t,i){var r=this;r.foodCatId=ko.observable(n);r.foodCatName=ko.observable(t);r.foodSetId=ko.observable(i)}function optionSelectFood(n,t){var i=this;i.foodId=ko.observable(n);i.foodName=ko.observable(t)}function optionSelectRevenue(n,t,i){var r=this;r.revenueClassId=ko.observable(n);r.revenueClassName=ko.observable(t);r.taxRateId=ko.observable(i)}function optionSelectChoiceOption(n,t,i){var r=this;r.choiceOptionId=ko.observable(n);r.choiceOptionName=ko.observable(t);r.plu=ko.observable(i)}function optionSelectChoiceOptionTemp(n,t){var i=this;i.choiceOptionId=ko.observable(n);i.choiceOptionName=ko.observable(t);i.choice=ko.observableArray([])}function optionSelectChoice(n,t,i,r){var u=this;u.choiceId=ko.observable(n);u.choiceName=ko.observable(t);u.choicePrice=ko.observable(i);u.plu=ko.observable(r)}function getThirdPartyGroup(n){var t=this;t.listThirdParty=ko.observableArray(n)}function mapDataFoodToModal(n,t){var i=vmViewIndex.menu,f,e,r,u;i.dataSetupFoodModal.foodId(n.foodId());i.dataSetupFoodModal.foodName(n.foodName());i.dataSetupFoodModal.foodNameAlt(n.foodNameAlt());i.dataSetupFoodModal.foodPrice(n.foodPrice());i.dataSetupFoodModal.foodDesc(n.foodDesc());i.dataSetupFoodModal.active(n.active());i.dataSetupFoodModal.foodSetId(n.foodSetId());i.dataSetupFoodModal.foodCatId(n.foodCatId());i.dataSetupFoodModal.revenueClassId(n.revenueClassId());i.dataSetupFoodModal.taxRateId(n.taxRateId());f=ko.utils.arrayFilter(i.tempDataFoodCategory(),function(t){return t.foodSetId()==n.foodSetId()});i.optionSelectPickerFoodCategory(f);i.dataSetupFoodModal.isOutStock(n.isOutStock());i.dataSetupFoodModal.isFree(n.isFree());i.dataSetupFoodModal.isShow(n.isShow());i.dataSetupFoodModal.tempId(n.tempId());i.dataSetupFoodModal.image(n.image());i.dataSetupFoodModal.imageThirdParty(n.imageThirdParty());i.dataSetupFoodModal.plu(n.plu());i.dataSetupFoodModal.listProductTag(n.listProductTag());i.dataSetupFoodModal.isThirdParty(n.isThirdParty());i.dataSetupFoodModal.foodBaseId(n.foodBaseId());i.dataSetupFoodModal.thirdPartyGroupId(n.thirdPartyGroupId());i.dataSetupFoodModal.productId(n.productId());n.productId!=null&&(e=n.productId().split(","));i.dataSetupFoodModal.arrProduct(e);i.dataSetupFoodModal.isShowProductTags(i.dataSetupFoodModal.arrProduct().includes("5")?!0:!1);vmViewIndex.globalConfig.orderLimit()==="1"||vmViewIndex.globalConfig.orderLimit()==="2"?i.dataSetupFoodModal.showLimit(!0):i.dataSetupFoodModal.showLimit(!1);i.dataSetupFoodModal.qtyLimit(n.qtyLimit());r=$("#modalSetupFoodThirdParty");u=r.find("img").attr("src");typeof u!="undefined"?u.trim().length>0?($("#modalSetupFoodThirdParty").find("img").attr("src",u),$("#modalSetupFoodThirdParty").find("img").attr("width",r.find("img").width()),$("#modalSetupFoodThirdParty").find("img").attr("height",r.find("img").height())):(i.dataSetupFoodModal.image(""),i.dataSetupFoodModal.imageThirdParty(""),$("#modalSetupFoodThirdParty").find("img").attr("src",""),$("#modalSetupFoodThirdParty").find("img").removeAttr("src"),$("#uploaderEdit"+n.tempId()).val("")):(i.dataSetupFoodModal.image(""),i.dataSetupFoodModal.imageThirdParty(""),$("#modalSetupFoodThirdParty").find("img").attr("src",""),$("#modalSetupFoodThirdParty").find("img").removeAttr("src"),$("#uploaderEdit"+n.tempId()).val(""));copyFoodThirdParty(i.dataSetupFoodModal.foodId(),t,0)}function linkThirdParty(n,t){for(var f,r,i=vmViewIndex.menu,u=0;u<i.thirdPartyGroups().length;u++)$("#group_"+u).removeClass("select-group");i.baseFoodThirdParty(n.foodId());n.isThirdParty()?(f=[],ko.utils.arrayForEach(i.thirdPartyStore(),function(n){f.push(n.thirdPartyId())}),i.thirdPartyGroups.push(new getThirdPartyGroup(f)),mapDataFoodToModal(n,t,!1),n.allChoiceOptions(i.dataSetupFoodModal.dataOptionFood()),r=ko.utils.arrayFilter(i.food(),function(t){return t.foodId()==n.foodId()}),i.foodInThirdPartyGroup.push(_.first(r)),i.choiceOptionsInThirdPartyGroup.push(new thirdPartyGroupChoiceOptionModel(i.choiceOptions(),i.optionSelectPickerChoiceOptionTemp()))):(r=ko.utils.arrayFilter(i.listFoodThirdPartyStore(),function(t){return t.foodBaseId()==n.foodId()}),ko.utils.arrayForEach(r,function(n){var u=ko.utils.arrayFilter(i.thirdPartyGroupStore(),function(t){return t.thirdPartyGroupId()==n.thirdPartyGroupId()}),f=_.first(u).thirdPartyId().split(","),r=[];_.forEach(f,function(n){r.push(parseInt(n))});i.thirdPartyGroups.push(new getThirdPartyGroup(r));mapDataFoodToModal(n,t,!1);n.allChoiceOptions(i.dataSetupFoodModal.dataOptionFood());i.foodInThirdPartyGroup.push(n);i.choiceOptionsInThirdPartyGroup.push(new thirdPartyGroupChoiceOptionModel(i.choiceOptions(),i.optionSelectPickerChoiceOptionTemp()))}),mapDataFoodToModal(_.first(r),t,!1),i.choiceOptions(_.first(i.choiceOptionsInThirdPartyGroup()).choiceOptions()),i.optionSelectPickerChoiceOptionTemp(_.first(i.choiceOptionsInThirdPartyGroup()).optionSelectPickerChoiceOptionTemp()));i.listThirdPartyGroups(ko.toJSON(i.thirdPartyGroups()));i.listFoodInThirdPartyGroup(ko.toJSON(i.foodInThirdPartyGroup()));$("#group_0").addClass("select-group")}function onClickThirdParty(n){for(var r,i,t=vmViewIndex.menu,e=vmViewIndex.menu.thirdPartyGroups().length,f=$("#modalSetupFoodThirdParty .select-group")[0].attributes.id.value.split("_")[1],u=0;u<e;u++)$("#group_"+u).removeClass("select-group");r=n.element.context.attributes.id.value;$("#"+r).addClass("select-group");i=r.split("_")[1];f!=i&&(replaceDataFoodInArray(f),i=r.split("_")[1],mapDataFoodToModal(t.foodInThirdPartyGroup()[i],event,!0),t.dataSetupFoodModal.foodId()==t.baseFoodThirdParty()&&t.choiceOptionsInThirdPartyGroup()[i].choiceOptions().length==0?(t.choiceOptionsInThirdPartyGroup()[i].choiceOptions(t.choiceOptions().slice(0)),t.choiceOptionsInThirdPartyGroup()[i].optionSelectPickerChoiceOptionTemp(t.optionSelectPickerChoiceOptionTemp.slice(0))):(t.choiceOptionsInThirdPartyGroup()[i].optionSelectPickerChoiceOptionTemp().length==0?(t.choiceOptions(t.choiceOptionsInThirdPartyGroup()[i].choiceOptions()),t.optionSelectPickerChoiceOptionTemp(t.choiceOptionsInThirdPartyGroup()[i].optionSelectPickerChoiceOptionTemp())):(t.optionSelectPickerChoiceOptionTemp(t.choiceOptionsInThirdPartyGroup()[i].optionSelectPickerChoiceOptionTemp()),t.choiceOptions(t.choiceOptionsInThirdPartyGroup()[i].choiceOptions())),chkChoiceOption(),t.dataSetupFoodModal.dataOptionFood(ko.toJSON(t.choiceOptions())),t.dataSetupFoodModal.valCopyFood(null)),t.listThirdPartyGroups(ko.toJSON(t.thirdPartyGroups())),t.listFoodInThirdPartyGroup(ko.toJSON(t.foodInThirdPartyGroup())))}function replaceDataFoodInArray(n){var t=vmViewIndex.menu.dataSetupFoodModal,i=new foodReplaceModel(t);vmViewIndex.menu.foodInThirdPartyGroup.replace(vmViewIndex.menu.foodInThirdPartyGroup()[n],i)}function foodReplaceModel(n){var t=this;t.active=ko.observable(n.active());t.allChoiceOptions=ko.observable(n.dataOptionFood());t.arrProduct=ko.observableArray([]);t.choiceOption=ko.observable();t.createOn=ko.observable();t.foodBaseId=ko.observable(0);t.foodCatId=ko.observable(n.foodCatId());t.foodDesc=ko.observable(n.foodDesc());t.foodId=ko.observable(n.foodId());t.foodName=ko.observable(n.foodName());t.foodNameAlt=ko.observable(n.foodNameAlt());t.foodPrice=ko.observable(n.foodPrice());t.foodSetId=ko.observable(n.foodSetId());t.foodSorting=ko.observable(n.foodSorting());t.foodThirdParty=ko.observable();t.groupThirdParty=ko.observable();t.image=ko.observable(n.image());t.isFree=ko.observable(n.isFree());t.isLimit=ko.observable(!1);t.isOutStock=ko.observable(n.isOutStock());t.isShow=ko.observable(n.isShow());t.isShowInstruction=ko.observable(!1);t.isThirdParty=ko.observable(!0);t.listProductTag=ko.observableArray(n.listProductTag());t.modifyOn=ko.observable();t.productId=ko.observable(n.productId());t.productTagMap=ko.observable();t.qtyLimit=ko.observable(n.qtyLimit());t.revenueClassId=ko.observable(n.revenueClassId());t.taxRateId=ko.observable(n.taxRateId());t.tempId=ko.observable(n.tempId());t.thirdPartyGroupId=ko.observable(n.thirdPartyGroupId());t.productTagMap=ko.observable(n.productTagSelect())}function onChangeThirdParty(n){var t=vmViewIndex.menu,s,h,e,u,f,r;if(!(n.value.length==0&&t.thirdPartyGroups().length==1)){if(n.previousValue.length>n.value.length){var r=ko.utils.arrayFilter(n.previousValue,function(t){return!n.value.includes(t)}),i=_.findIndex(t.thirdPartyGroups(),function(t){return t.listThirdParty().join(",")==n.value.join(",")}),c=new getThirdPartyGroup(n.value),o=i+1;if(o==t.thirdPartyGroups().length)if(n.value.length==0){for(u=t.thirdPartyGroups()[i-1].listThirdParty().slice(0),u.push(_.first(r)),f=new getThirdPartyGroup(sortArrayInt(u)),t.thirdPartyGroups.replace(t.thirdPartyGroups()[i-1],f),t.thirdPartyGroups.splice(i,1),t.foodInThirdPartyGroup.splice(i,1),t.choiceOptionsInThirdPartyGroup.splice(i,1),e=0;e<t.thirdPartyGroups().length;e++)$("#group_"+e).removeClass("select-group");s=i-1;$("#group_"+s).addClass("select-group");mapDataFoodToModal(t.foodInThirdPartyGroup()[s],event,!0);t.choiceOptions(t.choiceOptionsInThirdPartyGroup()[s].choiceOptions());t.optionSelectPickerChoiceOptionTemp(t.choiceOptionsInThirdPartyGroup()[s].optionSelectPickerChoiceOptionTemp())}else f=new getThirdPartyGroup(r),t.thirdPartyGroups.push(f),h=ko.utils.arrayFilter(t.food(),function(n){return n.foodId()==t.dataSetupFoodModal.foodId()}),t.foodInThirdPartyGroup.push(_.first(h)),t.choiceOptionsInThirdPartyGroup.push(new thirdPartyGroupChoiceOptionModel([],[]));else if(o<t.thirdPartyGroups().length)if(n.value.length==0){for(u=t.thirdPartyGroups()[o].listThirdParty().slice(0),u.push(_.first(r)),f=new getThirdPartyGroup(sortArrayInt(u)),t.thirdPartyGroups.replace(t.thirdPartyGroups()[o],f),t.thirdPartyGroups.splice(i,1),t.foodInThirdPartyGroup.splice(i,1),t.choiceOptionsInThirdPartyGroup.splice(i,1),e=0;e<t.thirdPartyGroups().length;e++)$("#group_"+e).removeClass("select-group");$("#group_"+i).addClass("select-group");mapDataFoodToModal(t.foodInThirdPartyGroup()[i],event,!0);t.choiceOptions(t.choiceOptionsInThirdPartyGroup()[i].choiceOptions());t.optionSelectPickerChoiceOptionTemp(t.choiceOptionsInThirdPartyGroup()[i].optionSelectPickerChoiceOptionTemp())}else u=t.thirdPartyGroups()[o].listThirdParty().slice(0),u.push(_.first(r)),f=new getThirdPartyGroup(sortArrayInt(u)),t.thirdPartyGroups.replace(t.thirdPartyGroups()[o],f)}else r=ko.utils.arrayFilter(n.value,function(t){return!n.previousValue.includes(t)}),ko.utils.arrayForEach(r,function(i){var u=_.findIndex(t.thirdPartyGroups(),function(t){return t.listThirdParty().includes(i)&&t.listThirdParty().join(",")!=n.value.join(",")}),e,l,a,o,c,s,h,v;if(u!=-1){if(e=t.thirdPartyGroups()[u].listThirdParty().slice(0),l=_.findIndex(e,function(n){return n==i}),e.splice(l,1),a=new getThirdPartyGroup(e),t.thirdPartyGroups.replace(t.thirdPartyGroups()[u],a),t.thirdPartyGroups()[u].listThirdParty().length==0&&(t.thirdPartyGroups.splice(u,1),t.foodInThirdPartyGroup.splice(u,1),t.optionSelectPickerChoiceOptionTemp.splice(u,1)),i==r[r.length-1]){var f=_.findIndex(t.thirdPartyGroups(),function(t){return t.listThirdParty().join(",")==n.value.join(",")}),y=t.thirdPartyGroups()[f].listThirdParty().slice(0),h=new getThirdPartyGroup(sortArrayInt(y));for(t.thirdPartyGroups.replace(t.thirdPartyGroups()[f],h),o=0;o<t.thirdPartyGroups().length;o++)$("#group_"+o).removeClass("select-group");$("#group_"+f).addClass("select-group");mapDataFoodToModal(t.foodInThirdPartyGroup()[f],event,!0);t.choiceOptions(t.choiceOptionsInThirdPartyGroup()[f].choiceOptions());t.optionSelectPickerChoiceOptionTemp(t.choiceOptionsInThirdPartyGroup()[f].optionSelectPickerChoiceOptionTemp())}}else c=[],ko.utils.arrayForEach(t.thirdPartyStore(),function(n){c.push(n.thirdPartyId())}),s=[],ko.utils.arrayForEach(c,function(n){r.includes(n)||s.push(n)}),s.length!=0&&(h=new getThirdPartyGroup(sortArrayInt(s)),t.thirdPartyGroups.push(h),v=ko.utils.arrayFilter(t.food(),function(n){return n.foodId()==t.dataSetupFoodModal.foodId()}),t.foodInThirdPartyGroup.push(_.first(v)),t.choiceOptionsInThirdPartyGroup.push(new thirdPartyGroupChoiceOptionModel([],[])))});t.listThirdPartyGroups(ko.toJSON(t.thirdPartyGroups()));t.listFoodInThirdPartyGroup(ko.toJSON(t.foodInThirdPartyGroup()))}}function copyFoodThirdParty(n,t,i){var r=vmViewIndex.menu,f=ko.observableArray([]),u=ko.observableArray([]);r.dataSetupFoodModal.groupChoiceOptionId().length>0&&ko.utils.arrayForEach(r.dataSetupFoodModal.groupChoiceOptionId(),function(t){var o=ko.utils.arrayFilter(r.foodChoiceMap(),function(i){return i.choiceOptionId()==t&&i.foodId()==n}),e;o.length>0&&(u.push(new getChoiceOptions(i)),f.push(new optionSelectChoiceOptionTemp(0,"")),e=u().length-1,f()[e].choiceOptionId(t),f()[e].choiceOptionName(_.first(o).choiceOptionName()),ko.utils.arrayFilter(r.dataSetupFoodModal.dataAllChoice(),function(n){n.choiceOptionId==t&&f()[e].choice.push(new optionSelectChoice(n.choiceId,n.choiceName,n.choicePrice))}),u()[e].ChoiceOptionId(t),u()[e].ChoiceOptionName(_.first(o).choiceOptionName()),ko.utils.arrayForEach(o,function(n){u()[e].Choice.push(new getChoice(n.choiceId(),n.choiceName(),n.choicePrice(),n.choiceOptionId(),n.isDefault(),n.isDefault()))}))});r.choiceOptions([]);r.optionSelectPickerChoiceOptionTemp(f().slice(0));r.choiceOptions(u().slice(0));chkChoiceOption();r.dataSetupFoodModal.dataOptionFood(ko.toJSON(r.choiceOptions()));vmViewIndex.menu.dataSetupFoodModal.valCopyFood(null)}function thirdPartyGroupChoiceOptionModel(n,t){var i=this;i.choiceOptions=ko.observableArray(n);i.optionSelectPickerChoiceOptionTemp=ko.observableArray(t)}function replaceChoiceOptionThirdParty(){var n=vmViewIndex.menu,t;n.choiceOptionsInThirdPartyGroup().length>0&&(t=$("#modalSetupFoodThirdParty .select-group")[0].attributes.id.value.split("_")[1],n.choiceOptionsInThirdPartyGroup()[t].choiceOptions(n.choiceOptions().slice(0)),n.choiceOptionsInThirdPartyGroup()[t].optionSelectPickerChoiceOptionTemp(n.optionSelectPickerChoiceOptionTemp.slice(0)))}function copyFood(n,t,i,r){var u=vmViewIndex.menu;u.dataSetupFoodModal.groupChoiceOptionId().length>0&&ko.utils.arrayForEach(u.dataSetupFoodModal.groupChoiceOptionId(),function(t){var e=ko.utils.arrayFilter(u.foodChoiceMap(),function(i){return i.choiceOptionId()==t&&i.foodId()==n}),o,f;e.length>0&&(o=ko.utils.arrayFilter(u.dataSetupFoodModal.dataAllChoiceOption(),function(n){return n.choiceOptionId==t}),(!r||r&&isEmpty(o[0].plu))&&(u.choiceOptions.push(new getChoiceOptions(i)),u.optionSelectPickerChoiceOptionTemp.push(new optionSelectChoiceOptionTemp(0,"")),f=u.choiceOptions().length-1,u.optionSelectPickerChoiceOptionTemp()[f].choiceOptionId(t),u.optionSelectPickerChoiceOptionTemp()[f].choiceOptionName(_.first(e).choiceOptionName()),ko.utils.arrayFilter(u.dataSetupFoodModal.dataAllChoice(),function(n){n.choiceOptionId==t&&u.optionSelectPickerChoiceOptionTemp()[f].choice.push(new optionSelectChoice(n.choiceId,n.choiceName,n.choicePrice,n.plu))}),u.choiceOptions()[f].ChoiceOptionId(t),u.choiceOptions()[f].ChoiceOptionName(_.first(e).choiceOptionName()),u.choiceOptions()[f].Plu(o[0].plu),ko.utils.arrayForEach(e,function(n){var t=ko.utils.arrayFilter(u.dataSetupFoodModal.dataAllChoice(),function(t){return t.choiceId==n.choiceId()});(!r||r&&isEmpty(t[0].plu))&&u.choiceOptions()[f].Choice.push(new getChoice(n.choiceId(),n.choiceName(),n.choicePrice(),n.choiceOptionId(),n.isDefault(),n.isDefault(),t[0].plu))})))});chkChoiceOption();u.dataSetupFoodModal.dataOptionFood(ko.toJSON(u.choiceOptions()));vmViewIndex.menu.dataSetupFoodModal.valCopyFood(null)}function updateCart(){var n=vmViewIndex.menu,t=$(".card").find(".card-block .cart");n.arrModelCopyFood().length<=0?(t.hide(),n.chkClickCopyFood(!1)):t.show()}function clearCopyFood(){var n=vmViewIndex.menu;n.arrModelCopyFood([]);$(".border-food").removeClass("border-copy-food")}function chkChoiceOption(){for(var i,n=vmViewIndex.menu,t=0;t<n.choiceOptions().length-1;t++)i=ko.utils.arrayFilter(n.choiceOptions(),function(i){return i.ChoiceOptionId()==n.choiceOptions()[t].ChoiceOptionId()}),i.length>1&&(swal(cError_ChoiceOption_Invalid,cError_ChoiceOptionName_Duplicate,cSwal_Icon_Error),n.chkSelectedChoiceOption(!1));n.choiceOptions().length>0&&(n.disableClickClearCopyFood(!1),ko.utils.arrayFirst(n.choiceOptions(),function(t){if(isEmpty(t.Plu())){if(t.Choice().length>0)return ko.utils.arrayFirst(t.Choice(),function(t){if(!isEmpty(t.Plu()))return n.disableClickClearCopyFood(!0),!0})}else return n.disableClickClearCopyFood(!0),!0}))}function onChangeFoodSet(n){var t=vmViewIndex.menu,i=n.itemData.foodSetId(),r;i.trim().length>0&&(r=ko.utils.arrayFilter(t.tempDataFoodCategory(),function(n){return n.foodSetId()==i}),t.optionSelectPickerFoodCategory(r))}function onChangeRevenue(n){var t=vmViewIndex.menu,r=n.itemData.revenueClassId(),i;if(r.trim().length>0){for(i=0;i<t.optionSelectPickerRevenue().length;i++)if(t.optionSelectPickerRevenue()[i].revenueClassId()==r){t.dataSetupFoodModal.taxRateId(t.optionSelectPickerRevenue()[i].taxRateId());break}}else t.dataSetupFoodModal.taxRateId(ko.observable())}function itemTemplateChoiceOptionAndChoice(n,t){var i=t?"":n.choicePrice()!=0?n.choiceName()+" $"+n.choicePrice():n.choiceName();return`<div class = '${isEmpty(n.plu())?"":"deliverect"}'>${t?n.choiceOptionName():i}&nbsp&nbsp<img src='${isEmpty(n.plu())?"":cDeliverectLogo}' /></div>`}function onChangeChoiceOption(n){var t=vmViewIndex.menu,r=n.itemData.choiceOptionId(),e=_.first(n.element).dataset.id,f=n.itemData.choiceOptionName(),i=_.first(n.element.parent().parent().find("span input:eq(0)")).id,u;if(r.trim().length>0){for(i=parseInt(_.first(i.match(/\d+/))),t.choiceOptions()[i].ChoiceOptionId(""),u=0;u<t.choiceOptions().length;u++)if(t.choiceOptions()[u].ChoiceOptionId()==r&&t.choiceOptions()[u].Active())return swal(cError_ChoiceOption_Invalid,cError_ChoiceOptionName_Duplicate,cSwal_Icon_Error),r=-1,!0;if(n.itemData.plu()!="")return swal(cError_ChoiceOption_Invalid,cError_ChoiceOptionName_Deliverect,cSwal_Icon_Error),!0;t.optionSelectPickerChoiceOptionTemp()[i].choiceOptionId(r);t.optionSelectPickerChoiceOptionTemp()[i].choiceOptionName(f);t.optionSelectPickerChoiceOptionTemp()[i].choice([]);t.choiceOptions()[i].ChoiceOptionId(r);t.choiceOptions()[i].ChoiceOptionName(f);t.choiceOptions()[i].Choice([]);ko.utils.arrayFilter(t.dataSetupFoodModal.dataAllChoice(),function(n){n.choiceOptionId==r&&t.optionSelectPickerChoiceOptionTemp()[i].choice.push(new optionSelectChoice(n.choiceId,n.choiceName,n.choicePrice,n.plu))});replaceChoiceOptionThirdParty()}}function onChangeChoice(n){var i=vmViewIndex.menu,f=n.itemData.choiceId(),s=n.itemData.choiceName(),t=_.first(n.element.parent().parent().parent().parent().parent().parent().find(".card-header span input:eq(0)")).id,h,u,e,r,o;if(f.trim().length>0){for(h=0,u=_.first(n.element.next().find("input:eq(0)")).id,t=parseInt(_.first(t.match(/\d+/))),u=parseInt(_.first(u.match(/(\d+)(?!.*\d)/))),i.choiceOptions()[t].Choice()[u].ChoiceId(""),e=0;e<i.choiceOptions()[t].Choice().length;e++)if(i.choiceOptions()[t].Choice()[e].ChoiceId()!=undefined&&i.choiceOptions()[t].Choice()[e].ChoiceId()==f){for(r=0;r<i.optionSelectPickerChoiceOptionTemp()[t].choice().length;r++)if(i.optionSelectPickerChoiceOptionTemp()[t].choice()[r].choiceId()==f){o=i.optionSelectPickerChoiceOptionTemp()[t].choice()[r].choicePrice();o="0.00";$("#ChoiceOption_"+t+"_Choice_"+u+"_ChoicePrice").val(Number2Digit(o));swal(cError_ChoiceOption_Invalid,cError_ChoiceOptionName_Duplicate,cSwal_Icon_Error);f=-1;break}return!0}if(n.itemData.plu()!="")return swal(cError_ChoiceOption_Invalid,cError_ChoiceOptionName_Deliverect,cSwal_Icon_Error),!0;for(i.choiceOptions()[t].Choice()[u].ChoiceId(f),i.choiceOptions()[t].Choice()[u].ChoiceName(s),i.dataSetupFoodModal.dataOptionFood(ko.toJSON(i.choiceOptions())),r=0;r<i.optionSelectPickerChoiceOptionTemp()[t].choice().length;r++)if(i.optionSelectPickerChoiceOptionTemp()[t].choice()[r].choiceId()==f){o=i.optionSelectPickerChoiceOptionTemp()[t].choice()[r].choicePrice();$("#ChoiceOption_"+t+"_Choice_"+u+"_ChoicePrice").val(Number2Digit(o));break}replaceChoiceOptionThirdParty()}}function changeActiveFoodCategory(n,t){swal({title:"Are you sure, you want to change active this foodcategory?",type:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,closeOnCancel:!1,confirmButtonClass:"btn theme default-button",cancelButtonClass:"btn btn-danger",preConfirm:function(){var i=new ObjUrl(n),r=i.getUrlFromJson(),u={model:t.foodCategory,modelFoodSet:t.foodSet};return new Promise(function(){$.ajax({url:r,async:ajax_async,cache:ajax_cache,type:ajax_type_post,data:u,timeout:ajax_timeout}).done(function(n){var u,i,r;if(n.status){var f=ko.observableArray([]),e=JSON.parse(n.obj),t=new DataFoodCategoryViewModel(e),o=ko.utils.arrayFilter(vmViewIndex.menu.foodCategory(),function(n){return n.foodCatId()==t.foodCatId()});isEmpty(o)||vmViewIndex.menu.foodCategory.replace(_.first(o),t);u=ko.utils.arrayFilter(vmViewIndex.menu.foodCategoryJs(),function(n){return n.foodCatId==t.foodCatId()});isEmpty(u)||vmViewIndex.menu.foodCategoryJs.replace(_.first(u),e);i=ko.utils.arrayFilter(vmViewIndex.menu.tempDataFoodCategory(),function(n){return n.foodCatId()==t.foodCatId()});isEmpty(i)||vmViewIndex.menu.tempDataFoodCategory.replace(_.first(i),new optionSelectFoodCategory(t.foodCatId(),t.foodCatName(),_.first(i).foodSetId()));vmViewIndex.menu.optionSelectPickerFoodCategory(vmViewIndex.menu.tempDataFoodCategory());ko.utils.arrayForEach(vmViewIndex.menu.foodSet(),function(n){ko.utils.arrayForEach(vmViewIndex.menu.foodCategory(),function(t){var i=ko.utils.arrayFilter(vmViewIndex.menu.food(),function(i){return i.foodCatId()==t.foodCatId()&&i.foodSetId()==n.foodSetId()});isEmpty(i)||f.push(new DataMenuViewModel(n,t,i))})});vmViewIndex.menu.dataMenu(f().slice());r=new ObjAlert("",n.message,n.status);r.getAlert();foodSetClick()}else r=new ObjAlert("",n.message,n.status),r.getAlert()}).fail(function(n){var t=new ObjAlert("",n.message,n.status);t.getAlert();foodSetClick()})})}})}function iconSortable(n,t){var r;$(n).find("tbody").sortable({cursor:"move",forcePlaceholderSize:!1,opacity:.4,placeholder:"highlight",start:function(n,t){t.item.toggleClass("highlight");r=t.item.index()},update:function(){},stop:function(u,f){var o,s,e,h,c;if(f.item.toggleClass("highlight"),o=f.item.index(),r!=o){if(r<o){for(s=[],e=null,t.load().done(function(n){e=ko.mapping.fromJS(_.orderBy(ko.mapping.toJS(n),["sorting"],["asc"]))()}),h=e[r].iconId(),c=e[o].sorting(),i=r;i<o;i++)s.push({iconId:e[i+1].iconId(),sorting:e[i].sorting()});s.push({iconId:h,sorting:c})}else if(r>o){for(s=[],e=null,t.load().done(function(n){e=ko.mapping.fromJS(_.orderBy(ko.mapping.toJS(n),["sorting"],["asc"]))()}),h=e[r].iconId(),c=e[o].sorting(),i=r;i>o;i--)s.push({iconId:e[i-1].iconId(),sorting:e[i].sorting()});s.push({iconId:h,sorting:c})}setTimeout(function(){ko.utils.arrayForEach(s,function(n){vmViewIndex.menu.dataSetupFoodModal.listIconForDrag().update(n.iconId,{sorting:n.sorting})});n.dxDataGrid("instance").refresh()},1e3)}}})}function iconSortingModel(n,t){var i=this;i.iconId=ko.observable(n.iconId());i.iconName=ko.observable(n.iconName());i.iconImage=ko.observable(n.iconImage());i.hexColor=ko.observable(n.iconName());i.isFocus=ko.observable(n.isFocus());i.isShowText=ko.observable(n.isShowText());i.active=ko.observable(n.active());i.sorting=ko.observable(t)}function Number2Digit(n){return parseFloat(n).toFixed(2)}function setTimeAMPM(n){return moment(n,"hh:mm").format("hh:mm A")}function swalUnlockFoodDeliverect(n){swal({title:cMessage_Unlock_Deliverect,type:"question",showCancelButton:!0,confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!1,closeOnCancel:!1,confirmButtonClass:"btn theme default-button",cancelButtonClass:"btn btn-danger"}).then(function(){var t=vmViewIndex.menu,i;t.dataSetupFoodModal.plu("");t.choiceOptions([]);t.optionSelectPickerChoiceOptionTemp([]);i=n.menu.dataSetupFoodModal.foodId();copyFood(i,event,1,!0);$("#modalSetupFood #selectPickerSection, #modalSetupFood #selectPickerRevenue, #modalSetupFood #selectCopyFood").dxSelectBox({disabled:!1});$("#modalSetupFood #tagFood, #modalSetupFood #iconFood").dxTagBox({disabled:!1});$("#modalSetupFood #grid-icon").dxDataGrid({disabled:!1})},function(n){n==="cancel"})}var popupElement,imageResize;$(".po-link_showTime").popover({trigger:"hover",html:!0,title:function(){return $(this).parent().find(".po-title_showTime").html()},content:function(){return $(this).parent().find(".po-body_showTime").html()},container:"body",placement:"bottom"});$("#popoverContainer").dxPopover({target:"#btnSetupFood",showEvent:"dxclick",title:function(){return $(this).parent().find(".popover-setupfood-title-show").html()},content:function(){return $(this).parent().find(".popover-setupfood-body-show").html()},container:"body",showCloseButton:!0});popupElement='<div id="switch-on"><\/div>';$("#popbutton").popover({animation:!0,content:popupElement,html:!0});$("#switch-on").dxSwitch({value:!0});imageResize=function(n){function r(n,i,r,f,e){var s=typeof i=="string",o=s||i;s&&(o=new Image,o.onload=t,o.onerror=u);o._onresample=e;o._width=r;o._height=f;o._elt=n;s?o.src=i:t.call(i)}function u(){throw"not found: "+this.src;}function t(){var t=this,e=t._width,o=t._height,h=t._onresample;t._elt.data("original-width",t.width);t._elt.data("original-height",t.height);var c=Math.min(t.height,t.width),s=t.width/t.height,l=o/e,r=s<=1?e:i(t.width*o/t.height),u=s>1?o:i(t.height*e/t.width);r=115;u=115;t._elt.data("width",r);t._elt.data("height",u);delete t._onresample;delete t._width;delete t._height;n.width=r;n.height=u;f.drawImage(t,0,0,t.width,t.height,0,0,r,u);h(n.toDataURL("image/png"),r,u)}var f=n.getContext("2d"),i=Math.round;return r}(this.document.createElement("canvas"));